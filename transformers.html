<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>COMPSS 211 - Understanding Transformer Attention</title>
    <style>
        :root{
            --bg:#ffffff;
            --panel:#f8f9fa;
            --muted:#6c757d;
            --text:#212529;
            --blue:#0d6efd;
            --indigo:#6610f2;
            --purple:#6610f2;
            --emerald:#198754;
            --orange:#fd7e14;
            --border:#dee2e6;
            --red:#dc3545;
        }
        *{box-sizing:border-box}
        body {
            margin:0; 
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            background:var(--bg); 
            color:var(--text);
            line-height: 1.5;
        }
        .wrap{max-width:1200px;margin:32px auto;padding:0 20px}
        .course-header{
            text-align:center;
            margin-bottom:20px;
            padding:16px;
            background:var(--panel);
            border-radius:12px;
            border:1px solid var(--border)
        }
        .course-title{
            font-size:1.2em;
            color:var(--blue);
            margin:0;
            font-weight:600
        }
        h1{font-size:32px;margin:0 0 12px; text-align: center;}
        p.lead{color:var(--muted);margin:0 0 24px; font-size: 18px; text-align: center;}
        .intro{
            background:var(--panel); 
            border:1px solid var(--border); 
            border-radius:16px; 
            padding:24px;
            margin-bottom: 24px; 
            box-shadow:0 2px 8px rgba(0,0,0,.1);
        }
        .intro h2{margin:0 0 12px; color:var(--blue);}
        .intro p{margin:12px 0; font-size: 16px;}
        
        .stage {
            border:1px solid var(--border); 
            border-radius:16px; 
            padding:24px; 
            background:var(--bg); 
            margin-bottom:24px;
            box-shadow:0 2px 8px rgba(0,0,0,.1);
        }
        .stage h2{margin:0 0 12px; font-size:20px; color:var(--blue);}
        .step-number{
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            background: var(--blue);
            color: white; 
            font-weight: bold; 
            font-size: 12px; 
            margin-right: 8px;
        }
        .explanation {
            font-size:15px; 
            color:var(--text); 
            margin-bottom:16px; 
            background:rgba(13,110,253,.08); 
            padding:12px 16px; 
            border-radius:12px;
            border-left: 4px solid var(--blue);
        }
        
        .goal{
            background:rgba(255,179,102,.1); 
            border:1px solid rgba(255,179,102,.3); 
            border-radius:12px; 
            padding:16px; 
            margin:16px 0;
        }
        .goal h3{margin:0 0 8px; color:var(--orange);}
        .chip{
            display:inline-flex; 
            gap:6px; 
            align-items:center; 
            padding:8px 12px; 
            border-radius:999px; 
            border:1px solid var(--border);
            background:var(--bg); 
            font-size:14px; 
            margin:4px 8px 4px 0; 
            font-weight: 500;
            transition: all 0.3s;
        }
        .chip.word-clickable{
            cursor: pointer;
        }
        .chip.word-clickable:hover, .chip[onclick]:hover{
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .chip.selected {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }
        .chip.query{ background:rgba(239,68,68,.15); border-color:rgba(239,68,68,.4); color:var(--red) }
        .chip.key{ background:rgba(34,197,94,.15); border-color:rgba(34,197,94,.4); color:var(--emerald) }
        .chip.value{ background:rgba(59,130,246,.15); border-color:rgba(59,130,246,.4); color:var(--blue) }
        
        .attention-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
            max-width: 600px;
        }
        
        .attention-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:10px 14px;
            border-radius:12px;
            border:1px solid var(--border);
            background:var(--bg);
            color:var(--text);
            cursor:pointer; 
            font-size: 14px;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        .btn:hover{
            background:var(--panel); 
            transform: translateY(-1px);
        }
        .btn:disabled{
            background: var(--panel);
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-primary{
            background:var(--blue);
            color:white;
            border-color:var(--blue);
        }
        .btn-primary:hover{
            background:#0b5ed7;
            border-color:#0b5ed7;
        }
        .matrix-toggle.active{
            background:var(--blue);
            color:white;
            border-color:var(--blue);
        }
        .matrix-toggle.active:hover{
            background:#0b5ed7;
            border-color:#0b5ed7;
        }
        .matrix-demo{
            transition: opacity 0.3s ease;
        }
        .card{
            background:var(--panel); 
            border:1px solid var(--border); 
            border-radius:16px; 
            padding:18px;
            box-shadow:0 2px 8px rgba(0,0,0,.1);
            margin: 20px 0;
        }
        
        .arrow {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #667eea;
            margin: 10px auto;
        }
        
        .tag{
            font-size:14px;
            color:var(--muted); 
            padding: 8px 12px; 
            background: var(--panel); 
            border-radius: 8px;
            margin: 5px;
            display: inline-block;
            font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas;
        }
        .tag b{color:var(--text)}
        
        .highlight {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="course-header">
            <div class="course-title">COMPSS 211 - Advanced Computing</div>
        </div>
        <h1>Understanding Transformer Attention</h1>
        <p class="lead">Interactive tutorial on how attention mechanisms work in transformers</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 20%"></div>
        </div>

        <!-- Introduction -->
        <div class="intro">
            <h2>What are we learning?</h2>
            <p>Transformers revolutionized AI by introducing the <strong>attention mechanism</strong>. Unlike earlier models that process words sequentially, transformers can look at all words simultaneously and decide which ones are most relevant for understanding each word.</p>
            
            <div class="goal">
                <h3>Learning Objective: Self-Attention</h3>
                <p>Understand how transformers use Query, Key, and Value matrices to compute attention scores, allowing the model to focus on relevant parts of the input when processing each word.</p>
            </div>
        </div>

        <!-- Step 1: Introduction -->
        <div class="stage">
            <h2><span class="step-number">1</span>What is Attention?</h2>
            <div class="explanation">
                <strong>Simple Definition:</strong> Attention is a mechanism that helps the model decide which words to "pay attention to" when understanding each word in a sentence.
            </div>
            <div class="card">
                <p>Let's work with this sentence that has clear relationships:</p>
                <div id="sentence">
                    <span class="chip" style="cursor: default;">The</span>
                    <span class="chip" style="cursor: default;">black</span>
                    <span class="chip" style="cursor: default;">cat</span>
                    <span class="chip" style="cursor: default;">ate</span>
                    <span class="chip" style="cursor: default;">fish</span>
                </div>
            <p style="color: var(--muted); margin-top: 20px; font-size: 14px;">
                <strong>Think about it:</strong> To understand "cat" fully, the model needs to know it's a "black cat" (not just any cat) that "ate fish" (not sleeping or playing). This is why attention matters - words get meaning from their context!
            </p>
            <button class="btn btn-primary" onclick="showStep1b()" style="margin-top: 15px;">Let's Learn How! →</button>
        </div>
    </div>

        <!-- Step 2: What are Transformers? -->
        <div class="stage hidden" id="step1b">
            <h2><span class="step-number">2</span>What are Transformers?</h2>
            <div class="explanation">
                <strong>The Big Picture:</strong> Transformers are a type of neural network architecture that revolutionized AI by processing all words in a sentence simultaneously, rather than one by one like older models. Previous models like RNNs (Recurrent Neural Networks) and LSTMs (Long Short-Term Memory networks) had to read text sequentially, word by word, which made them slower and less effective at understanding long-range relationships.
            </div>
            <div class="card">
                <div class="goal">
                    <h3>How Transformers Differ from Earlier Models</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div style="padding: 15px; background: rgba(239,68,68,.1); border-radius: 8px; border-left: 4px solid var(--red);">
                            <h4 style="color: var(--red); margin: 0 0 8px;">Old Way (RNNs/LSTMs)</h4>
                            <p style="margin: 0; font-size: 14px;">Process words sequentially: "The" → "black" → "cat" → "ate" → "fish"</p>
                            <p style="margin: 8px 0 0; font-size: 13px; color: var(--muted);">Slow, struggles with long sequences</p>
                        </div>
                        <div style="padding: 15px; background: rgba(25,135,84,.1); border-radius: 8px; border-left: 4px solid var(--emerald);">
                            <h4 style="color: var(--emerald); margin: 0 0 8px;">Transformer Way</h4>
                            <p style="margin: 0; font-size: 14px;">Process all words at once using <strong>self-attention</strong></p>
                            <p style="margin: 8px 0 0; font-size: 13px; color: var(--muted);">Fast, handles long sequences well</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="color: var(--blue); margin-bottom: 10px;">The Key Innovation: Self-Attention</h4>
                    <p>Instead of processing words in order, transformers ask: <em>"For each word, which other words in the sentence should I pay attention to?"</em></p>
                    
                    <!-- Attention visualization -->
                    <div style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin: 20px 0;">
                        <div style="position: relative; padding: 40px 0 80px; margin: 10px auto; max-width: 500px;">
                            <!-- Words row -->
                            <div style="display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 2;">
                                <span class="chip" style="background: rgba(102,16,242,0.15); border: 1px solid rgba(102,16,242,0.3); color: var(--indigo); font-size: 13px; padding: 6px 16px;">the</span>
                                <span class="chip" style="background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: var(--red); font-size: 13px; padding: 6px 16px;">black</span>
                                <span class="chip" style="background: rgba(255,193,7,0.15); border: 2px solid rgba(255,193,7,0.6); color: #856404; font-size: 13px; padding: 6px 16px; font-weight: bold;">cat</span>
                                <span class="chip" style="background: rgba(102,16,242,0.2); border: 1px solid rgba(102,16,242,0.4); color: var(--indigo); font-size: 13px; padding: 6px 16px;">ate</span>
                                <span class="chip" style="background: rgba(102,16,242,0.15); border: 1px solid rgba(102,16,242,0.3); color: var(--indigo); font-size: 13px; padding: 6px 16px;">fish</span>
                            </div>
                            
                            <!-- Attention weights bar -->
                            <div style="position: absolute; bottom: 40px; left: 0; right: 0; height: 40px; display: flex; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="width: 10%; background: rgba(102,16,242,0.2); display: flex; align-items: center; justify-content: center; color: var(--muted); font-size: 11px;">10%</div>
                                <div style="width: 45%; background: rgba(239,68,68,0.3); display: flex; align-items: center; justify-content: center; color: var(--red); font-weight: bold; font-size: 12px;">45%</div>
                                <div style="width: 0%; background: transparent;"></div>
                                <div style="width: 30%; background: rgba(102,16,242,0.3); display: flex; align-items: center; justify-content: center; color: var(--indigo); font-size: 11px;">30%</div>
                                <div style="width: 15%; background: rgba(102,16,242,0.2); display: flex; align-items: center; justify-content: center; color: var(--muted); font-size: 11px;">15%</div>
                            </div>
                            
                            <!-- Label -->
                            <div style="position: absolute; bottom: -10px; left: 0; right: 0; text-align: center; font-size: 11px; color: var(--muted);">
                                "cat" simultaneously considers ALL words to understand its context
                            </div>
                        </div>
                        
                        <p style="margin: 0; font-size: 13px; color: var(--text);">
                            The bar shows how much attention "cat" pays to each word. Notice it focuses most on "black" (45%) - its descriptor - and "ate" (30%) - the action it performs.
                        </p>
                    </div>
                </div>
                
                <div style="background: rgba(102,16,242,.08); border: 1px solid rgba(102,16,242,.3); border-radius: 8px; padding: 15px; margin-top: 20px;">
                    <h4 style="color: var(--indigo); margin: 0 0 8px;">Real-World Impact</h4>
                    <p style="margin: 0; font-size: 14px;">This is what powers ChatGPT, Claude, Gemini and most other modern AI language models. The attention mechanism lets them understand complex relationships between words, no matter how far apart they are in a sentence!</p>
                </div>
            </div>
            <button class="btn btn-primary" onclick="showStep2()">Next: How Does Attention Work? →</button>
        </div>

        <!-- Step 3: Query, Key, Value -->
        <div class="stage hidden" id="step2">
            <h2><span class="step-number">3</span>The Three Components: Query, Key, Value</h2>
            <div class="explanation">
                <strong>The Problem with Traditional Embeddings:</strong> In traditional word embeddings, each token gets just one static vector - but a single vector can't capture how words relate to each other in different contexts. The word "bank" means something different in "river bank" vs "bank account", but traditional embeddings can't adapt.
            </div>
            
            <div class="card">
                <!-- Traditional vs Transformer comparison -->
                <div style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                    <h4 style="color: var(--blue); margin: 0 0 15px;">Traditional Embeddings vs Transformers</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="padding: 15px; background: rgba(239,68,68,.08); border-radius: 8px; border-left: 4px solid var(--red);">
                            <h5 style="color: var(--red); margin: 0 0 10px;">Traditional: Single Vector</h5>
                            <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                                <span class="chip" style="font-size: 12px;">cat</span>
                                <span style="color: var(--muted);">→</span>
                                <div style="background: white; border: 1px solid var(--border); padding: 8px; border-radius: 6px; font-family: monospace; font-size: 11px;">
                                    [0.2, -0.5, 0.8]
                                </div>
                            </div>
                            <p style="margin: 10px 0 0; font-size: 12px; color: var(--muted);">
                                Same vector regardless of context.<br>
                                Can't ask questions or provide answers.
                            </p>
                        </div>
                        
                        <div style="padding: 15px; background: rgba(25,135,84,.08); border-radius: 8px; border-left: 4px solid var(--emerald);">
                            <h5 style="color: var(--emerald); margin: 0 0 10px;">Transformers: Three Vectors</h5>
                            <div style="display: flex; flex-direction: column; gap: 5px; margin: 10px 0;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span class="chip" style="font-size: 12px;">cat</span>
                                    <span style="color: var(--muted);">→</span>
                                    <div style="display: flex; flex-direction: column; gap: 3px;">
                                        <div style="background: rgba(239,68,68,.1); border: 1px solid rgba(239,68,68,.3); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 10px;">
                                            Q: [0.1, 0.9, -0.2]
                                        </div>
                                        <div style="background: rgba(34,197,94,.1); border: 1px solid rgba(34,197,94,.3); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 10px;">
                                            K: [0.8, -0.3, 0.5]
                                        </div>
                                        <div style="background: rgba(59,130,246,.1); border: 1px solid rgba(59,130,246,.3); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 10px;">
                                            V: [0.3, 0.6, -0.1]
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p style="margin: 10px 0 0; font-size: 12px; color: var(--muted);">
                                Dynamic representations for each role.<br>
                                Can query, be queried, and provide values.
                            </p>
                        </div>
                    </div>
                </div>
                
                <h4 style="color: var(--blue); margin-bottom: 15px;">How Q, K, V Are Created</h4>
                <p>Each word's embedding is transformed by three learned matrices to create these specialized representations:</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="text-align: center; padding: 15px; background: rgba(239,68,68,.08); border-radius: 8px; border: 1px solid rgba(239,68,68,.3);">
                        <div class="chip query" style="margin-bottom: 10px;">Query (Q)</div>
                        <p style="font-size: 13px; color: var(--muted); margin: 8px 0;"><strong>W<sub>Q</sub></strong> matrix</p>
                        <p style="font-size: 12px; margin: 0;">"What am I looking for?"</p>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(34,197,94,.08); border-radius: 8px; border: 1px solid rgba(34,197,94,.3);">
                        <div class="chip key" style="margin-bottom: 10px;">Key (K)</div>
                        <p style="font-size: 13px; color: var(--muted); margin: 8px 0;"><strong>W<sub>K</sub></strong> matrix</p>
                        <p style="font-size: 12px; margin: 0;">"What do I offer?"</p>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(59,130,246,.08); border-radius: 8px; border: 1px solid rgba(59,130,246,.3);">
                        <div class="chip value" style="margin-bottom: 10px;">Value (V)</div>
                        <p style="font-size: 13px; color: var(--muted); margin: 8px 0;"><strong>W<sub>V</sub></strong> matrix</p>
                        <p style="font-size: 12px; margin: 0;">"What information do I contain?"</p>
                    </div>
                </div>

                <div class="goal">
                    <h3>🧮 Matrix Transformation Example</h3>
                    <p>Let's see how the word "cat" gets transformed (simplified 3D example):</p>
                    
                    <!-- Matrix Toggle Buttons -->
                    <div style="display: flex; justify-content: center; gap: 8px; margin: 15px 0;">
                        <button class="btn matrix-toggle active" data-matrix="query" onclick="showMatrix('query')">
                            <span style="color: var(--red);">●</span> W<sub>Q</sub> Query
                        </button>
                        <button class="btn matrix-toggle" data-matrix="key" onclick="showMatrix('key')">
                            <span style="color: var(--emerald);">●</span> W<sub>K</sub> Key
                        </button>
                        <button class="btn matrix-toggle" data-matrix="value" onclick="showMatrix('value')">
                            <span style="color: var(--blue);">●</span> W<sub>V</sub> Value
                        </button>
                    </div>
                    
                    <div style="margin: 20px 0; font-family: ui-monospace, monospace; font-size: 13px;">
                        <!-- Query Matrix (default visible) -->
                        <div id="matrix-query" class="matrix-demo">
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; gap: 10px; align-items: center; margin: 15px 0;">
                                <!-- Word Embedding -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--text);">Word "cat"</div>
                                    <div style="background: var(--panel); padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
                                        [0.2]<br>[0.8]<br>[0.1]
                                    </div>
                                </div>
                                
                                <!-- × symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">×</div>
                                
                                <!-- W_Q Matrix -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--red);">W<sub>Q</sub> matrix</div>
                                    <div style="background: rgba(239,68,68,.08); padding: 10px; border-radius: 6px; border: 1px solid rgba(239,68,68,.3);">
                                        [1.0, 0.2, 0.5]<br>[0.1, 1.5, 0.3]<br>[0.4, 0.2, 0.9]
                                    </div>
                                </div>
                                
                                <!-- = symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">=</div>
                                
                                <!-- Query Result -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--red);">Query</div>
                                    <div style="background: rgba(239,68,68,.15); padding: 10px; border-radius: 6px; border: 1px solid rgba(239,68,68,.4); color: var(--red); font-weight: bold;">
                                        [0.3]<br>[1.3]<br>[0.2]
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; color: var(--muted); font-size: 12px; margin: 10px 0;">
                                The <strong>Query</strong> represents "what this word is looking for" in other words
                            </div>
                        </div>

                        <!-- Key Matrix (hidden by default) -->
                        <div id="matrix-key" class="matrix-demo" style="display: none;">
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; gap: 10px; align-items: center; margin: 15px 0;">
                                <!-- Word Embedding -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--text);">Word "cat"</div>
                                    <div style="background: var(--panel); padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
                                        [0.2]<br>[0.8]<br>[0.1]
                                    </div>
                                </div>
                                
                                <!-- × symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">×</div>
                                
                                <!-- W_K Matrix -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--emerald);">W<sub>K</sub> matrix</div>
                                    <div style="background: rgba(34,197,94,.08); padding: 10px; border-radius: 6px; border: 1px solid rgba(34,197,94,.3);">
                                        [0.8, 1.1, 0.2]<br>[0.3, 0.7, 1.2]<br>[1.0, 0.1, 0.6]
                                    </div>
                                </div>
                                
                                <!-- = symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">=</div>
                                
                                <!-- Key Result -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--emerald);">Key</div>
                                    <div style="background: rgba(34,197,94,.15); padding: 10px; border-radius: 6px; border: 1px solid rgba(34,197,94,.4); color: var(--emerald); font-weight: bold;">
                                        [1.0]<br>[1.2]<br>[0.3]
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; color: var(--muted); font-size: 12px; margin: 10px 0;">
                                The <strong>Key</strong> represents "what type of information this word can provide"
                            </div>
                        </div>

                        <!-- Value Matrix (hidden by default) -->
                        <div id="matrix-value" class="matrix-demo" style="display: none;">
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; gap: 10px; align-items: center; margin: 15px 0;">
                                <!-- Word Embedding -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--text);">Word "cat"</div>
                                    <div style="background: var(--panel); padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
                                        [0.2]<br>[0.8]<br>[0.1]
                                    </div>
                                </div>
                                
                                <!-- × symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">×</div>
                                
                                <!-- W_V Matrix -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--blue);">W<sub>V</sub> matrix</div>
                                    <div style="background: rgba(59,130,246,.08); padding: 10px; border-radius: 6px; border: 1px solid rgba(59,130,246,.3);">
                                        [0.6, 0.9, 1.1]<br>[1.3, 0.4, 0.7]<br>[0.2, 1.5, 0.3]
                                    </div>
                                </div>
                                
                                <!-- = symbol -->
                                <div style="text-align: center; font-size: 20px; color: var(--blue);">=</div>
                                
                                <!-- Value Result -->
                                <div style="text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--blue);">Value</div>
                                    <div style="background: rgba(59,130,246,.15); padding: 10px; border-radius: 6px; border: 1px solid rgba(59,130,246,.4); color: var(--blue); font-weight: bold;">
                                        [1.1]<br>[1.5]<br>[0.5]
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; color: var(--muted); font-size: 12px; margin: 10px 0;">
                                The <strong>Value</strong> represents "the actual content/meaning this word contributes"
                            </div>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(102,16,242,.08); border: 1px solid rgba(102,16,242,.3); border-radius: 8px; padding: 15px; margin-top: 20px;">
                    <h4 style="color: var(--indigo); margin: 0 0 8px;">⚡ The Key Insight</h4>
                    <p style="margin: 0; font-size: 14px;">Each word gets THREE different representations of itself. The Query asks "what should I attend to?", Keys answer "I can provide this type of info", and Values contain "here's my actual content". The magic happens when Queries find matching Keys!</p>
                </div>
            </div>
            <button class="btn btn-primary" onclick="showStep3()">Next: Calculate Attention Scores →</button>
    </div>

        <!-- Step 4: Calculating Attention Scores -->
        <div class="stage hidden" id="step3">
            <h2><span class="step-number">4</span>Calculating Attention Scores</h2>
            <div class="explanation">
                We calculate how relevant each word is to our current word by comparing Query with all Keys.
                <br>Higher score = more relevant = pay more attention!
            </div>
            <div class="card">
            <p><strong>Let's calculate attention for the word "cat":</strong></p>
            <p>Click each box to see how much "cat" should attend to each word:</p>
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 20px 0;">
                    <div class="attention-calculation" data-word="The" onclick="calculateAttention(0)">
                        <div class="chip">The</div>
                        <div class="tag hidden" id="score-0"><b>Score:</b> 0.15</div>
                    </div>
                    <div class="attention-calculation" data-word="black" onclick="calculateAttention(1)">
                        <div class="chip">black</div>
                        <div class="tag hidden" id="score-1"><b>Score:</b> 0.7</div>
                    </div>
                    <div class="attention-calculation" data-word="cat" onclick="calculateAttention(2)">
                        <div class="chip">cat</div>
                        <div class="tag hidden" id="score-2"><b>Score:</b> 0.9</div>
                    </div>
                    <div class="attention-calculation" data-word="ate" onclick="calculateAttention(3)">
                        <div class="chip">ate</div>
                        <div class="tag hidden" id="score-3"><b>Score:</b> 0.4</div>
                    </div>
                    <div class="attention-calculation" data-word="fish" onclick="calculateAttention(4)">
                        <div class="chip">fish</div>
                        <div class="tag hidden" id="score-4"><b>Score:</b> 0.3</div>
                    </div>
            </div>
            <div id="attention-explanation" class="hidden explanation" style="margin-top: 20px;">
                ✨ Notice: "cat" pays most attention to itself (0.9) and its descriptor "black" (0.7), moderate attention to the action "ate" (0.4), and less to "The" and "fish"!
            </div>
        </div>
            <button class="btn btn-primary" id="step3-next" disabled onclick="showStep4()">Next: Visualize the Matrix →</button>
    </div>

        <!-- Step 5: Attention Matrix -->
        <div class="stage hidden" id="step4">
            <h2><span class="step-number">5</span>The Attention Matrix</h2>
            <div class="explanation">
                The attention matrix shows how much each word (row) attends to every other word (column).
                <br>Darker = stronger attention, Lighter = weaker attention
            </div>
            <div class="card">
            <p><strong>Hover over any cell to see the attention relationship:</strong></p>
            <div style="display: flex; align-items: center; justify-content: center;">
                <div>
                    <div style="display: grid; grid-template-columns: 50px repeat(5, 70px); gap: 5px; margin: 20px;">
                        <div></div>
                        <div style="text-align: center; font-weight: bold;">The</div>
                        <div style="text-align: center; font-weight: bold;">black</div>
                        <div style="text-align: center; font-weight: bold;">cat</div>
                        <div style="text-align: center; font-weight: bold;">ate</div>
                        <div style="text-align: center; font-weight: bold;">fish</div>
                        
                        <div style="font-weight: bold; display: flex; align-items: center;">The</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.3);" onmouseover="showAttention('The', 'The', 0.3)">0.3</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('The', 'black', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('The', 'cat', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('The', 'ate', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.05);" onmouseover="showAttention('The', 'fish', 0.05)">0.05</div>
                        
                        <div style="font-weight: bold; display: flex; align-items: center;">black</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('black', 'The', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.8);" onmouseover="showAttention('black', 'black', 0.8)">0.8</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.7);" onmouseover="showAttention('black', 'cat', 0.7)">0.7</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.2);" onmouseover="showAttention('black', 'ate', 0.2)">0.2</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('black', 'fish', 0.1)">0.1</div>
                        
                        <div style="font-weight: bold; display: flex; align-items: center;">cat</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.15);" onmouseover="showAttention('cat', 'The', 0.15)">0.15</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.7);" onmouseover="showAttention('cat', 'black', 0.7)">0.7</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.9);" onmouseover="showAttention('cat', 'cat', 0.9)">0.9</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.4);" onmouseover="showAttention('cat', 'ate', 0.4)">0.4</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.3);" onmouseover="showAttention('cat', 'fish', 0.3)">0.3</div>
                        
                        <div style="font-weight: bold; display: flex; align-items: center;">ate</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('ate', 'The', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.3);" onmouseover="showAttention('ate', 'black', 0.3)">0.3</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.6);" onmouseover="showAttention('ate', 'cat', 0.6)">0.6</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.8);" onmouseover="showAttention('ate', 'ate', 0.8)">0.8</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.7);" onmouseover="showAttention('ate', 'fish', 0.7)">0.7</div>
                        
                        <div style="font-weight: bold; display: flex; align-items: center;">fish</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.05);" onmouseover="showAttention('fish', 'The', 0.05)">0.05</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.1);" onmouseover="showAttention('fish', 'black', 0.1)">0.1</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.3);" onmouseover="showAttention('fish', 'cat', 0.3)">0.3</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.7);" onmouseover="showAttention('fish', 'ate', 0.7)">0.7</div>
                        <div class="attention-cell" style="background: rgba(13, 110, 253, 0.9);" onmouseover="showAttention('fish', 'fish', 0.9)">0.9</div>
                    </div>
                </div>
            </div>
            <div id="matrix-explanation" style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; min-height: 50px;">
                Hover over any cell to see the relationship
            </div>
        </div>
            <button class="btn btn-primary" onclick="showCalculator()">Next: Try the Live Calculator! →</button>
    </div>

        <!-- Step 6: Live Attention Calculator -->
        <div class="stage hidden" id="calculator">
            <h2><span class="step-number">6</span>Live Attention Calculator</h2>
            <div class="explanation">
                🧮 <strong>The Real Mechanism:</strong> Attention scores come from dot products between Query and Key vectors. Let's see how changing the Query or Key vectors affects attention!
            </div>
            <div class="card">
                <p><strong>Understanding Q·K Dot Products:</strong></p>
                <p style="font-size: 14px; color: var(--muted); margin-bottom: 8px;">The attention score between two words is calculated as: <code style="background: var(--panel); padding: 2px 6px; border-radius: 4px;">attention_score = Query_word1 · Key_word2</code></p>
                
                <div style="background: rgba(102,16,242,.08); border: 1px solid rgba(102,16,242,.3); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <p style="margin: 0; font-size: 13px; color: var(--indigo);"><strong>Real Scale:</strong> In actual transformers like GPT-4, Q, K, V vectors are typically 64-128 dimensions each (we're using 3D for simplicity). Large models can have 12,288 dimensions!</p>
                </div>
                
                <!-- Show Current Vectors -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="padding: 15px; background: rgba(239,68,68,.08); border-radius: 8px; border: 1px solid rgba(239,68,68,.3);">
                        <h4 style="color: var(--red); margin: 0 0 10px;">Query vector for "cat"</h4>
                        <div style="font-family: ui-monospace, monospace; font-size: 13px;">
                            Q_cat = [<span id="q-cat-0">0.3</span>, <span id="q-cat-1">1.3</span>, <span id="q-cat-2">0.2</span>]
                        </div>
                        <div style="margin-top: 10px;">
                            <label style="display: block; font-size: 12px; margin-bottom: 5px;">Adjust Q_cat[0]:</label>
                            <input type="range" min="-2" max="2" step="0.1" value="0.3" 
                                   oninput="updateQueryValue(0, this.value)" 
                                   style="width: 100%;">
                        </div>
                        <div style="margin-top: 8px;">
                            <label style="display: block; font-size: 12px; margin-bottom: 5px;">Adjust Q_cat[1]:</label>
                            <input type="range" min="-2" max="2" step="0.1" value="1.3" 
                                   oninput="updateQueryValue(1, this.value)" 
                                   style="width: 100%;">
                        </div>
                        
                        <div style="margin-top: 12px; padding: 10px; background: rgba(255,193,7,.1); border-radius: 6px; border-left: 3px solid var(--orange);">
                            <p style="margin: 0; font-size: 12px; color: var(--text);"><strong>What's happening:</strong> When you adjust Q_cat values, you're changing what "cat" is "looking for". Higher values in dimensions where Key vectors also have high values = stronger attention!</p>
                        </div>
                    </div>
                    
                    <div style="padding: 15px; background: rgba(34,197,94,.08); border-radius: 8px; border: 1px solid rgba(34,197,94,.3);">
                        <h4 style="color: var(--emerald); margin: 0 0 10px;">Key vectors (fixed)</h4>
                        <div style="font-family: ui-monospace, monospace; font-size: 12px;">
                            K_the = [0.1, 0.2, 0.1]<br>
                            K_black = [0.8, 1.0, 0.3]<br>
                            K_cat = [1.0, 1.2, 0.3]<br>
                            K_ate = [0.4, 0.6, 0.8]<br>
                            K_fish = [0.2, 0.3, 0.9]
                        </div>
                    </div>
                </div>

                <div class="goal">
                    <h3>Live Dot Product Calculation</h3>
                    <div id="dot-products" style="margin: 15px 0; padding: 15px; background: var(--bg); border-radius: 8px; border: 1px solid var(--border);">
                        <div style="font-family: ui-monospace, monospace; font-size: 13px;" id="calculations">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div style="background: rgba(59,130,246,.08); border: 1px solid rgba(59,130,246,.3); border-radius: 8px; padding: 12px; margin-top: 10px;">
                        <p style="margin: 0; font-size: 12px; color: var(--text);"><strong>Example:</strong> If you increase Q_cat[1] to match K_black[1] (both = 1.0), "cat" will pay more attention to "black" because they align in that dimension. This is how transformers learn semantic relationships!</p>
                    </div>
                </div>
                
                <div id="live-attention" style="margin-top: 20px; padding: 15px; background: var(--panel); border-radius: 8px;">
                    <strong>Softmax Normalized Attention Weights:</strong>
                    <div id="attention-bars" style="margin-top: 10px;"></div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="showStep5()">Continue to Interactive Demo →</button>
        </div>

        <!-- Step 7: Interactive Demo -->
        <div class="stage hidden" id="step5">
            <h2><span class="step-number">7</span>Try It Yourself!</h2>
            <div class="explanation">
                Click on any word to see which words it pays attention to. The thickness and color of the lines show attention strength.
            </div>
            <div class="card">
            <p><strong>Click a word to see its attention pattern:</strong></p>
            <svg id="attention-viz" width="600" height="200" style="display: block; margin: 20px auto;">
                <!-- Will be populated by JavaScript -->
            </svg>
                <div id="demo-words" style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
                    <div class="chip" onclick="showAttentionPattern(0)">The</div>
                    <div class="chip" onclick="showAttentionPattern(1)">black</div>
                    <div class="chip" onclick="showAttentionPattern(2)">cat</div>
                    <div class="chip" onclick="showAttentionPattern(3)">ate</div>
                    <div class="chip" onclick="showAttentionPattern(4)">fish</div>
                </div>
        </div>
            <button class="btn btn-primary" onclick="showSummary()">See Summary →</button>
    </div>

        <!-- Summary -->
        <div class="intro hidden" id="summary">
            <h2>✓ Congratulations! You Understand Attention!</h2>
            <div class="goal" style="background: rgba(25,135,84,.1); border-color: rgba(25,135,84,.3);">
                <h3 style="color: var(--emerald);">🎉 Key Takeaways</h3>
                <ul style="margin: 0; padding-left: 20px;">
                    <li>Attention helps models understand context by focusing on relevant words</li>
                    <li>Each word has Query, Key, and Value representations</li>
                    <li>Attention scores determine how much to focus on each word</li>
                    <li>The attention matrix shows all word relationships at once</li>
                    <li>This mechanism allows transformers to capture complex language patterns!</li>
                </ul>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="restart()">↻ Start Over</button>
            </div>
        </div>
    </div>

    <script>
        let clickedWords = 0;
        let calculatedScores = 0;
        let currentStep = 1;

        // Initialize - optional word clicking for exploration (no requirement)
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to word chips for optional interaction
            document.getElementById('sentence').addEventListener('click', function(e) {
                if (e.target.classList.contains('word-clickable')) {
                    e.target.classList.toggle('selected');
                }
            });
        });

        function showStep1b() {
            document.getElementById('step1b').classList.remove('hidden');
            document.getElementById('step1b').classList.add('fade-in');
            currentStep = 2;
            updateProgress(30);
            document.getElementById('step1b').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showStep2() {
            document.getElementById('step2').classList.remove('hidden');
            document.getElementById('step2').classList.add('fade-in');
            currentStep = 3;
            updateProgress(45);
            document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
        }

        function showStep3() {
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('step3').classList.add('fade-in');
            currentStep = 4;
            updateProgress(60);
            document.getElementById('step3').scrollIntoView({ behavior: 'smooth' });
        }

        function calculateAttention(index) {
            document.getElementById(`score-${index}`).classList.remove('hidden');
            document.getElementById(`score-${index}`).classList.add('highlight');
            calculatedScores++;
            
            if (calculatedScores >= 5) {
                document.getElementById('attention-explanation').classList.remove('hidden');
                document.getElementById('step3-next').disabled = false;
            }
        }

        function showStep4() {
            document.getElementById('step4').classList.remove('hidden');
            document.getElementById('step4').classList.add('fade-in');
            currentStep = 5;
            updateProgress(75);
            document.getElementById('step4').scrollIntoView({ behavior: 'smooth' });
        }

        function showAttention(from, to, value) {
            const explanation = document.getElementById('matrix-explanation');
            const intensity = value > 0.5 ? 'strong' : 'weak';
            explanation.innerHTML = `<strong>"${from}"</strong> pays ${intensity} attention to <strong>"${to}"</strong> (${value})`;
            
            if (from === to) {
                explanation.innerHTML += '<br><em>Words often pay most attention to themselves!</em>';
            }
        }

        function showStep5() {
            document.getElementById('step5').classList.remove('hidden');
            document.getElementById('step5').classList.add('fade-in');
            currentStep = 7;
            updateProgress(95);
            document.getElementById('step5').scrollIntoView({ behavior: 'smooth' });
            initAttentionVisualization();
        }

        function initAttentionVisualization() {
            const svg = document.getElementById('attention-viz');
            svg.innerHTML = `
                <text x="300" y="100" text-anchor="middle" fill="#999">
                    Click a word below to see attention patterns
                </text>
            `;
        }

        function showAttentionPattern(wordIndex) {
            const words = ['The', 'black', 'cat', 'ate', 'fish'];
            const attentionWeights = [
                [0.3, 0.1, 0.1, 0.1, 0.05],  // The
                [0.1, 0.8, 0.7, 0.2, 0.1],   // black (attends to itself and cat)
                [0.15, 0.7, 0.9, 0.4, 0.3],  // cat (attends to black, itself, ate)
                [0.1, 0.3, 0.6, 0.8, 0.7],   // ate (attends to cat, itself, fish)
                [0.05, 0.1, 0.3, 0.7, 0.9]   // fish (attends to ate and itself)
            ];
            
            const svg = document.getElementById('attention-viz');
            svg.innerHTML = '';
            
            // Draw words at top
            words.forEach((word, i) => {
                const x = 60 + i * 110;
                const y = 50;
                
                // Word box
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x - 30);
                rect.setAttribute('y', y - 20);
                rect.setAttribute('width', 60);
                rect.setAttribute('height', 40);
                rect.setAttribute('rx', 5);
                rect.setAttribute('fill', i === wordIndex ? '#0d6efd' : '#f8f9fa');
                rect.setAttribute('stroke', '#ddd');
                svg.appendChild(rect);
                
                // Word text
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', y + 5);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', i === wordIndex ? 'white' : '#333');
                text.setAttribute('font-weight', 'bold');
                text.textContent = word;
                svg.appendChild(text);
            });
            
            // Draw attention lines from selected word
            const fromX = 60 + wordIndex * 110;
            const fromY = 70;
            
            words.forEach((word, i) => {
                const toX = 60 + i * 110;
                const toY = 150;
                const weight = attentionWeights[wordIndex][i];
                
                // Draw line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', fromX);
                line.setAttribute('y1', fromY);
                line.setAttribute('x2', toX);
                line.setAttribute('y2', toY);
                line.setAttribute('stroke', '#0d6efd');
                line.setAttribute('stroke-width', weight * 8);
                line.setAttribute('opacity', weight);
                svg.appendChild(line);
                
                // Draw target word
                const targetRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                targetRect.setAttribute('x', toX - 30);
                targetRect.setAttribute('y', toY - 20);
                targetRect.setAttribute('width', 60);
                targetRect.setAttribute('height', 40);
                targetRect.setAttribute('rx', 5);
                targetRect.setAttribute('fill', 'white');
                targetRect.setAttribute('stroke', '#0d6efd');
                targetRect.setAttribute('stroke-width', weight * 3);
                svg.appendChild(targetRect);
                
                const targetText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                targetText.setAttribute('x', toX);
                targetText.setAttribute('y', toY + 5);
                targetText.setAttribute('text-anchor', 'middle');
                targetText.setAttribute('fill', '#333');
                targetText.textContent = word;
                svg.appendChild(targetText);
                
                // Weight label
                const weightText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                weightText.setAttribute('x', (fromX + toX) / 2);
                weightText.setAttribute('y', (fromY + toY) / 2);
                weightText.setAttribute('text-anchor', 'middle');
                weightText.setAttribute('fill', '#0d6efd');
                weightText.setAttribute('font-size', '12');
                weightText.setAttribute('font-weight', 'bold');
                weightText.textContent = weight.toFixed(1);
                svg.appendChild(weightText);
            });
        }

        function showSummary() {
            document.getElementById('summary').classList.remove('hidden');
            document.getElementById('summary').classList.add('fade-in');
            updateProgress(100);
            document.getElementById('summary').scrollIntoView({ behavior: 'smooth' });
        }

        function updateProgress(percent) {
            document.getElementById('progress').style.width = percent + '%';
        }

        function restart() {
            location.reload();
        }

        // New interactive functions for live attention calculator - using real dot products
        let queryVector = [0.3, 1.3, 0.2];
        const keyVectors = {
            'the': [0.1, 0.2, 0.1],
            'black': [0.8, 1.0, 0.3], 
            'cat': [1.0, 1.2, 0.3],
            'ate': [0.4, 0.6, 0.8],
            'fish': [0.2, 0.3, 0.9]
        };
        
        function updateQueryValue(index, value) {
            queryVector[index] = parseFloat(value);
            document.getElementById(`q-cat-${index}`).textContent = value;
            calculateDotProducts();
        }
        
        function dotProduct(vec1, vec2) {
            return vec1.reduce((sum, val, i) => sum + val * vec2[i], 0);
        }
        
        function calculateDotProducts() {
            // Calculate dot products for each key vector
            const scores = {};
            const words = ['the', 'black', 'cat', 'ate', 'fish'];
            
            words.forEach(word => {
                scores[word] = dotProduct(queryVector, keyVectors[word]);
            });
            
            // Show calculations
            const calculationsDiv = document.getElementById('calculations');
            calculationsDiv.innerHTML = words.map(word => {
                const keyVec = keyVectors[word];
                const score = scores[word];
                return `Q_cat · K_${word} = [${queryVector.join(', ')}] · [${keyVec.join(', ')}] = <strong>${score.toFixed(2)}</strong>`;
            }).join('<br>');
            
            // Apply softmax to get attention weights
            const scoreValues = Object.values(scores);
            const expScores = scoreValues.map(s => Math.exp(s));
            const sumExp = expScores.reduce((a, b) => a + b, 0);
            const weights = expScores.map(e => e / sumExp);
            
            // Update attention bars
            const barsDiv = document.getElementById('attention-bars');
            const wordNames = ['The', 'black', 'cat', 'ate', 'fish'];
            
            barsDiv.innerHTML = wordNames.map((word, i) => {
                const weight = weights[i];
                const percentage = (weight * 100).toFixed(1);
                const rawScore = scoreValues[i];
                
                return `
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-weight: 500;">${word} (score: ${rawScore.toFixed(2)})</span>
                            <span style="color: var(--blue); font-weight: bold;">${percentage}%</span>
                        </div>
                        <div style="height: 24px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background: linear-gradient(90deg, var(--blue), var(--indigo)); transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Initialize the calculator when shown
        function showCalculator() {
            document.getElementById('calculator').classList.remove('hidden');
            document.getElementById('calculator').classList.add('fade-in');
            calculateDotProducts();
            updateProgress(85);
            document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Matrix toggle functionality
        function showMatrix(matrixType) {
            // Hide all matrix demos
            document.querySelectorAll('.matrix-demo').forEach(demo => {
                demo.style.display = 'none';
            });
            
            // Show selected matrix demo
            document.getElementById(`matrix-${matrixType}`).style.display = 'block';
            
            // Update button states
            document.querySelectorAll('.matrix-toggle').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-matrix="${matrixType}"]`).classList.add('active');
        }
    </script>
</body>
</html>